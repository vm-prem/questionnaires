<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Bias & Fairness Questionnaire</title>
  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --line: #e5e7eb;
      --accent: #2563eb;
      --req: #dc2626;
      --shadow: 0 8px 24px rgba(0,0,0,0.06);
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
      line-height: 1.35;
    }
    header {
      padding: 28px 18px 16px;
      max-width: 980px;
      margin: 0 auto;
    }
    h1 { margin: 0 0 6px; font-size: 22px; }
    .subtitle { margin: 0; color: var(--muted); font-size: 14px; }
    .container { max-width: 980px; margin: 0 auto; padding: 0 18px 60px; }
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      margin-top: 14px;
    }
    .banner {
      background: linear-gradient(180deg, rgba(37,99,235,0.10), rgba(37,99,235,0.03));
      border: 1px solid rgba(37,99,235,0.18);
    }
    .section-title {
      font-size: 16px;
      margin: 0 0 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--line);
    }
    .q {
      padding: 14px 0;
      border-bottom: 1px dashed var(--line);
    }
    .q:last-child { border-bottom: none; }
    label.title {
      display: block;
      font-weight: 650;
      margin-bottom: 6px;
    }
    .req {
      color: var(--req);
      font-weight: 700;
      margin-left: 2px;
    }
    .help {
      color: var(--muted);
      font-size: 13px;
      margin: 0 0 10px;
    }
    .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 880px) {
      .row.two { grid-template-columns: 1fr 1fr; }
      .row.three { grid-template-columns: 1fr 1fr 1fr; }
    }

    input[type="text"], textarea, select {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 14px;
      background: #fff;
      outline: none;
    }
    textarea { min-height: 96px; resize: vertical; }
    input[type="text"]:focus, textarea:focus, select:focus {
      border-color: rgba(37,99,235,0.55);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.14);
    }

    .checks {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      padding: 6px 0 2px;
    }
    @media (min-width: 880px) {
      .checks.cols2 { grid-template-columns: 1fr 1fr; }
      .checks.cols3 { grid-template-columns: 1fr 1fr 1fr; }
    }
    .check {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 10px;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fafafa;
    }
    .check input { margin-top: 3px; }
    .check span { font-size: 14px; }

    .small {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }

    .footerbar {
      position: sticky;
      bottom: 0;
      margin-top: 18px;
      padding: 12px 14px;
      border-top: 1px solid var(--line);
      background: rgba(247,247,251,0.92);
      backdrop-filter: blur(10px);
    }
    .footerbar .inner {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      align-items: center;
      padding: 0 18px;
    }
    button {
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 650;
      cursor: pointer;
      font-size: 14px;
    }
    button.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    button:active { transform: translateY(1px); }
    .status {
      margin-right: auto;
      color: var(--muted);
      font-size: 13px;
    }

    .pill {
      display: inline-block;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(37,99,235,0.10);
      border: 1px solid rgba(37,99,235,0.20);
      color: #1e3a8a;
      margin-left: 8px;
      vertical-align: middle;
    }
    .hr {
      border: none;
      border-top: 1px solid var(--line);
      margin: 14px 0 0;
    }
  
    /* --- PDF render container --- */
    #pdf-render {
      position: fixed;
      left: -99999px;
      top: 0;
      width: 920px;
      padding: 18px;
      background: #ffffff;
      color: #111827;
    }
    #pdf-render h1 { font-size: 18px; margin: 0 0 6px; }
    #pdf-render h2 { font-size: 14px; margin: 14px 0 8px; }
    #pdf-render .meta { font-size: 12px; color: #374151; margin-bottom: 10px; }
    #pdf-render .item { border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px 12px; margin: 8px 0; }
    #pdf-render .k { font-weight: 650; margin-bottom: 6px; }
    #pdf-render .v { white-space: pre-wrap; font-size: 13px; color: #111827; }

  </style>
</head>

<body>
  <header>
    <h1>Bias & Fairness Questionnaire <span class="pill">Model Owner Submission Form</span></h1>
    <p class="subtitle">
      Document how bias and fairness risks are identified, assessed, mitigated, monitored, and governed for AI / GenAI / Agentic AI systems.
      Responses must reflect <b>current, implemented practices</b> (not aspirational intent).
    </p>
  </header>

  <div class="container">
    <form id="bf-form">
      <div class="card banner">
        <p class="help" style="margin:0;">
          <b>Instructions:</b> Complete all required fields (<span class="req">*</span>).
          Provide concise, evidence-based answers. Do not paste sensitive data. Use “Evidence references” fields to link to internal artifacts.
        </p>
      </div>

      <!-- A -->
      <div class="card">
        <h2 class="section-title">A. Fairness Objectives, Scope & Stakeholders</h2>

        <div class="q">
          <label class="title">A1. Fairness Objective(s) <span class="req">*</span></label>
          <p class="help">Select all that apply and briefly explain why fairness analysis is required for this model.</p>

          <div class="checks cols2">
            <label class="check"><input type="checkbox" name="A1_objectives" value="Fair lending / anti-discrimination compliance"><span>Compliance with fair lending / anti-discrimination requirements</span></label>
            <label class="check"><input type="checkbox" name="A1_objectives" value="Disparate impact prevention"><span>Prevention of disparate impact on protected or vulnerable groups</span></label>
            <label class="check"><input type="checkbox" name="A1_objectives" value="Ethical use beyond legal minimum"><span>Ethical use of AI beyond minimum legal requirements</span></label>
            <label class="check"><input type="checkbox" name="A1_objectives" value="Customer / consumer protection"><span>Customer or consumer protection</span></label>
            <label class="check"><input type="checkbox" name="A1_objectives" value="Reputational risk"><span>Reputational risk management</span></label>
            <label class="check"><input type="checkbox" name="A1_objectives" value="Regulatory / audit expectations"><span>Regulatory, supervisory, or audit expectations</span></label>
            <label class="check"><input type="checkbox" name="A1_objectives" value="Internal risk appetite"><span>Internal risk appetite or governance standards</span></label>
            <label class="check"><input type="checkbox" id="A1_other_chk" name="A1_objectives" value="Other"><span>Other (describe below)</span></label>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label class="title">A1 (Free-text). Objective Rationale <span class="req">*</span></label>
              <textarea name="A1_rationale" required placeholder="1–5 sentences explaining why fairness analysis is needed given the model’s purpose, decision context, and affected populations."></textarea>
            </div>
            <div>
              <label class="title">A1 (Optional). Other Objective</label>
              <textarea name="A1_other_text" placeholder="If 'Other' selected above, describe it here."></textarea>
            </div>
          </div>
        </div>

        <div class="q">
          <label class="title">A2. Impacted Stakeholders & Populations <span class="req">*</span></label>
          <p class="help">Select all groups potentially impacted by model outcomes.</p>

          <div class="checks cols3">
            <label class="check"><input type="checkbox" name="A2_groups" value="Retail customers"><span>Retail customers</span></label>
            <label class="check"><input type="checkbox" name="A2_groups" value="Commercial customers"><span>Commercial customers</span></label>
            <label class="check"><input type="checkbox" name="A2_groups" value="Consumers / applicants"><span>Consumers / applicants</span></label>
            <label class="check"><input type="checkbox" name="A2_groups" value="Employees / internal users"><span>Employees / internal users</span></label>
            <label class="check"><input type="checkbox" name="A2_groups" value="Third parties"><span>Third parties</span></label>
            <label class="check"><input type="checkbox" name="A2_groups" value="Affected individuals"><span>Affected individuals subject to automated or AI-assisted decisions</span></label>
            <label class="check"><input type="checkbox" name="A2_groups" value="Regulators / supervisors"><span>Regulators / supervisors</span></label>
          </div>

          <label class="title" style="margin-top:10px;">A2 (Free-text). Impact Description <span class="req">*</span></label>
          <textarea name="A2_impact" required placeholder="Describe how each selected group may be affected by biased or unfair outcomes."></textarea>
        </div>

        <div class="q">
          <label class="title">A3. Decision Criticality & Harm Potential <span class="req">*</span></label>
          <p class="help">How consequential are decisions informed or made by this model if bias or unfairness is present?</p>

          <select name="A3_criticality" required>
            <option value="" selected disabled>-- select --</option>
            <option>Low (informational only; minimal impact)</option>
            <option>Moderate (influences decisions; human review expected)</option>
            <option>High (material customer/consumer impact; limited review)</option>
            <option>Very High (automated or near-automated consequential decisions)</option>
          </select>

          <p class="small">Tip: Consider legal, financial, access, privacy, safety, and reputational harms.</p>
        </div>
      </div>

      <!-- B -->
      <div class="card">
        <h2 class="section-title">B. Data Representativeness & Bias Risk Identification</h2>

        <div class="q">
          <label class="title">B1. Training & Input Data Representativeness <span class="req">*</span></label>
          <p class="help">How representative is the data used to train, fine-tune, prompt, or operate the model of the relevant population?</p>

          <select name="B1_repr" required>
            <option value="" selected disabled>-- select --</option>
            <option>Highly representative (validated coverage; minimal gaps)</option>
            <option>Mostly representative (some known gaps; mitigations in place)</option>
            <option>Partially representative (material gaps; residual risk remains)</option>
            <option>Unknown / not assessed</option>
          </select>

          <label class="title" style="margin-top:10px;">B1 (Free-text). Representativeness Assessment <span class="req">*</span></label>
          <textarea name="B1_assess" required placeholder="Describe known gaps, skews, exclusions, or differences between training/operating data and the intended population."></textarea>
        </div>

        <div class="q">
          <label class="title">B2. Sensitive Attributes & Proxies Identified? <span class="req">*</span></label>
          <p class="help">Have sensitive attributes (e.g., race, gender, age) or potential proxy variables been identified and assessed?</p>

          <select name="B2_sensitive" required>
            <option value="" selected disabled>-- select --</option>
            <option>Yes (identified and assessed; controls implemented)</option>
            <option>Partially (identified; assessment or controls incomplete)</option>
            <option>No (not identified/assessed)</option>
            <option>Not applicable (explain)</option>
          </select>

          <label class="title" style="margin-top:10px;">B2 (Free-text). Sensitive Attributes & Proxies <span class="req">*</span></label>
          <textarea name="B2_detail" required placeholder="List sensitive attributes considered (as applicable) and potential proxies. Explain how direct or indirect use is managed."></textarea>
        </div>

        <div class="q">
          <label class="title">B3. Known Sources of Bias Considered? <span class="req">*</span></label>
          <p class="help">Select all sources of bias that have been explicitly assessed.</p>

          <div class="checks cols2">
            <label class="check"><input type="checkbox" name="B3_sources" value="Historical / societal bias"><span>Historical / societal bias</span></label>
            <label class="check"><input type="checkbox" name="B3_sources" value="Sampling / selection bias"><span>Sampling or selection bias</span></label>
            <label class="check"><input type="checkbox" name="B3_sources" value="Measurement / labeling bias"><span>Measurement or labeling bias</span></label>
            <label class="check"><input type="checkbox" name="B3_sources" value="Proxy bias"><span>Proxy bias</span></label>
            <label class="check"><input type="checkbox" name="B3_sources" value="Feedback loop / reinforcement bias"><span>Feedback loop / reinforcement bias</span></label>
            <label class="check"><input type="checkbox" name="B3_sources" value="Prompt-induced bias (GenAI)"><span>Prompt-induced bias (GenAI)</span></label>
            <label class="check"><input type="checkbox" name="B3_sources" value="Agent behavior bias (tool selection, delegation, sequencing)"><span>Agent behavior bias (tool selection, delegation, sequencing)</span></label>
            <label class="check"><input type="checkbox" id="B3_other_chk" name="B3_sources" value="Other"><span>Other (describe below)</span></label>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label class="title">B3 (Free-text). Summary of Bias Risk Identification <span class="req">*</span></label>
              <textarea name="B3_summary" required placeholder="Summarize key bias risks identified and how they were evaluated."></textarea>
            </div>
            <div>
              <label class="title">B3 (Optional). Other Bias Source</label>
              <textarea name="B3_other_text" placeholder="If 'Other' selected above, describe it here."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- C -->
      <div class="card">
        <h2 class="section-title">C. Fairness Definitions & Metrics</h2>

        <div class="q">
          <label class="title">C1. Fairness Definition(s) Applied <span class="req">*</span></label>
          <p class="help">Select all fairness concepts used to evaluate this model.</p>

          <div class="checks cols2">
            <label class="check"><input type="checkbox" name="C1_defs" value="Demographic parity"><span>Demographic parity</span></label>
            <label class="check"><input type="checkbox" name="C1_defs" value="Equal opportunity"><span>Equal opportunity</span></label>
            <label class="check"><input type="checkbox" name="C1_defs" value="Equalized odds"><span>Equalized odds</span></label>
            <label class="check"><input type="checkbox" name="C1_defs" value="Individual fairness"><span>Individual fairness</span></label>
            <label class="check"><input type="checkbox" name="C1_defs" value="Counterfactual fairness"><span>Counterfactual fairness</span></label>
            <label class="check"><input type="checkbox" name="C1_defs" value="Human-centered / qualitative fairness assessment"><span>Human-centered or qualitative fairness assessment</span></label>
            <label class="check"><input type="checkbox" id="C1_other_chk" name="C1_defs" value="Other"><span>Other (describe below)</span></label>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label class="title">C1 (Free-text). Rationale for Selected Definitions <span class="req">*</span></label>
              <textarea name="C1_rationale" required placeholder="Explain why these fairness definitions are appropriate for the model’s decision context and risks."></textarea>
            </div>
            <div>
              <label class="title">C1 (Optional). Other Fairness Definition</label>
              <textarea name="C1_other_text" placeholder="If 'Other' selected above, describe it here."></textarea>
            </div>
          </div>
        </div>

        <div class="q">
          <label class="title">C2. Fairness Metrics & Thresholds <span class="req">*</span></label>
          <p class="help">Are quantitative or qualitative fairness metrics defined with thresholds or tolerance levels?</p>

          <select name="C2_defined" required>
            <option value="" selected disabled>-- select --</option>
            <option>Yes (metrics + thresholds defined and approved)</option>
            <option>Metrics defined (thresholds not finalized)</option>
            <option>Partially (limited metrics; gaps remain)</option>
            <option>No (not defined)</option>
          </select>

          <label class="title" style="margin-top:10px;">C2 (Free-text). Metrics & Thresholds <span class="req">*</span></label>
          <textarea name="C2_detail" required placeholder="Describe metrics used, thresholds applied, population(s) tested, and rationale for selection."></textarea>
        </div>

        <div class="q">
          <label class="title">C3. Population Segmentation <span class="req">*</span></label>
          <p class="help">At what level is fairness assessed?</p>

          <div class="checks cols2">
            <label class="check"><input type="checkbox" name="C3_scope" value="Global population only"><span>Global population only</span></label>
            <label class="check"><input type="checkbox" name="C3_scope" value="Key sub-segments (region/product/channel)"><span>Key sub-segments (e.g., region, product, channel)</span></label>
            <label class="check"><input type="checkbox" name="C3_scope" value="Protected class analysis"><span>Protected class analysis</span></label>
            <label class="check"><input type="checkbox" name="C3_scope" value="Intersectional analysis"><span>Intersectional analysis</span></label>
            <label class="check"><input type="checkbox" name="C3_scope" value="Scenario/use-case specific analysis"><span>Scenario-based or use-case-specific analysis</span></label>
          </div>

          <label class="title" style="margin-top:10px;">C3 (Free-text). Segmentation Approach <span class="req">*</span></label>
          <textarea name="C3_detail" required placeholder="Explain segmentation choices, coverage, and any exclusions/limitations."></textarea>
        </div>
      </div>

      <!-- D -->
      <div class="card">
        <h2 class="section-title">D. Testing, Monitoring & Stability</h2>

        <div class="q">
          <label class="title">D1. Fairness Testing Performed? <span class="req">*</span></label>
          <p class="help">Has fairness testing been conducted using appropriate data, scenarios, or simulations?</p>

          <select name="D1_tested" required>
            <option value="" selected disabled>-- select --</option>
            <option>Yes (comprehensive testing completed)</option>
            <option>Partially (limited testing completed)</option>
            <option>No (not tested)</option>
            <option>Not applicable (explain)</option>
          </select>

          <label class="title" style="margin-top:10px;">D1 (Free-text). Testing Summary <span class="req">*</span></label>
          <textarea name="D1_summary" required placeholder="Describe tests performed, datasets/scenarios used, and key findings. Include how GenAI prompts/agent behavior were tested if applicable."></textarea>
        </div>

        <div class="q">
          <label class="title">D2. Stability Over Time & Context <span class="req">*</span></label>
          <p class="help">How stable are fairness outcomes across time, data drift, prompt changes, or agent configurations?</p>

          <select name="D2_stability" required>
            <option value="" selected disabled>-- select --</option>
            <option>Stable (evaluated; low sensitivity)</option>
            <option>Mostly stable (some sensitivity; controls/monitoring in place)</option>
            <option>Unstable (material sensitivity; significant residual risk)</option>
            <option>Unknown / not assessed</option>
          </select>

          <label class="title" style="margin-top:10px;">D2 (Free-text). Sensitivity & Drift <span class="req">*</span></label>
          <textarea name="D2_detail" required placeholder="Describe known sensitivity to time, data, prompts, or agent configuration changes. Explain drift detection and response."></textarea>
        </div>

        <div class="q">
          <label class="title">D3. Ongoing Monitoring in Production? <span class="req">*</span></label>
          <p class="help">Is fairness monitored post-deployment?</p>

          <select name="D3_monitoring" required>
            <option value="" selected disabled>-- select --</option>
            <option>Yes (defined metrics, frequency, ownership, and alerts)</option>
            <option>Planned (not yet implemented)</option>
            <option>No (not monitored)</option>
            <option>Not applicable (explain)</option>
          </select>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label class="title">D3 (Free-text). Monitoring Design <span class="req">*</span></label>
              <textarea name="D3_design" required placeholder="Describe monitoring metrics, cadence, thresholds, alerting/escalation, and responsible teams."></textarea>
            </div>
            <div>
              <label class="title">D3 (Optional). Monitoring Artifacts / Dashboard IDs</label>
              <textarea name="D3_evidence" placeholder="Provide internal links/IDs to dashboards, reports, or monitoring artifacts. One item per line."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- E -->
      <div class="card">
        <h2 class="section-title">E. Mitigation Controls & Human Oversight</h2>

        <div class="q">
          <label class="title">E1. Bias Mitigation Techniques Implemented <span class="req">*</span></label>
          <p class="help">Select all that apply.</p>

          <div class="checks cols2">
            <label class="check"><input type="checkbox" name="E1_mitigations" value="Data rebalancing/augmentation"><span>Data rebalancing or augmentation</span></label>
            <label class="check"><input type="checkbox" name="E1_mitigations" value="Feature exclusion/constraint"><span>Feature exclusion or constraint</span></label>
            <label class="check"><input type="checkbox" name="E1_mitigations" value="Fairness-aware optimization"><span>Model regularization or fairness-aware optimization</span></label>
            <label class="check"><input type="checkbox" name="E1_mitigations" value="Prompt controls"><span>Prompt engineering or system instruction controls</span></label>
            <label class="check"><input type="checkbox" name="E1_mitigations" value="Human-in-the-loop review"><span>Human-in-the-loop review</span></label>
            <label class="check"><input type="checkbox" name="E1_mitigations" value="Output filtering/policy enforcement"><span>Output filtering or policy enforcement</span></label>
            <label class="check"><input type="checkbox" name="E1_mitigations" value="Escalation/override mechanisms"><span>Escalation or override mechanisms</span></label>
            <label class="check"><input type="checkbox" id="E1_other_chk" name="E1_mitigations" value="Other"><span>Other (describe below)</span></label>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label class="title">E1 (Free-text). Mitigation Summary <span class="req">*</span></label>
              <textarea name="E1_summary" required placeholder="Describe which mitigations were applied, when, and why. Explain any trade-offs (e.g., accuracy vs fairness)."></textarea>
            </div>
            <div>
              <label class="title">E1 (Optional). Other Mitigation</label>
              <textarea name="E1_other_text" placeholder="If 'Other' selected above, describe it here."></textarea>
            </div>
          </div>
        </div>

        <div class="q">
          <label class="title">E2. Human Review & Escalation <span class="req">*</span></label>
          <p class="help">How are potential bias or fairness issues identified, reviewed, and escalated?</p>

          <select name="E2_oversight" required>
            <option value="" selected disabled>-- select --</option>
            <option>Strong oversight (defined roles, review steps, and escalation paths)</option>
            <option>Moderate oversight (some reviews; gaps exist)</option>
            <option>Limited oversight (ad hoc; undocumented)</option>
            <option>No formal oversight</option>
          </select>

          <label class="title" style="margin-top:10px;">E2 (Free-text). Oversight in Practice <span class="req">*</span></label>
          <textarea name="E2_detail" required placeholder="Describe how humans detect, challenge, and intervene when fairness concerns arise. Include how overrides are logged and reviewed."></textarea>
        </div>
      </div>

      <!-- F -->
      <div class="card">
        <h2 class="section-title">F. Governance, Validation & Accountability</h2>

        <div class="q">
          <label class="title">F1. Independent Fairness Review <span class="req">*</span></label>
          <p class="help">Has bias and fairness been independently assessed (e.g., by MRM, validation, compliance)?</p>

          <select name="F1_review" required>
            <option value="" selected disabled>-- select --</option>
            <option>Yes (completed; evidence available)</option>
            <option>In progress</option>
            <option>No (not performed)</option>
            <option>Not applicable (explain)</option>
          </select>

          <label class="title" style="margin-top:10px;">F1 (Free-text). Review Details <span class="req">*</span></label>
          <textarea name="F1_detail" required placeholder="Describe scope, reviewers (roles), timing, methodology, and conclusions. Include key issues and remediation status, if any."></textarea>
        </div>

        <div class="q">
          <label class="title">F2. Roles & Accountability <span class="req">*</span></label>
          <p class="help">Who is accountable for fairness risk management? Select all that apply.</p>

          <div class="checks cols3">
            <label class="check"><input type="checkbox" name="F2_roles" value="Model Owner"><span>Model Owner</span></label>
            <label class="check"><input type="checkbox" name="F2_roles" value="Business Owner"><span>Business Owner</span></label>
            <label class="check"><input type="checkbox" name="F2_roles" value="MRM / Model Validation"><span>MRM / Model Validation</span></label>
            <label class="check"><input type="checkbox" name="F2_roles" value="Compliance / Legal"><span>Compliance / Legal</span></label>
            <label class="check"><input type="checkbox" name="F2_roles" value="AI Governance Committee"><span>AI Governance Committee</span></label>
            <label class="check"><input type="checkbox" id="F2_other_chk" name="F2_roles" value="Other"><span>Other (describe below)</span></label>
          </div>

          <div class="row two" style="margin-top:10px;">
            <div>
              <label class="title">F2 (Free-text). Accountability Model <span class="req">*</span></label>
              <textarea name="F2_detail" required placeholder="Describe decision rights, approvals, and ongoing ownership (including who signs off on thresholds and exceptions)."></textarea>
            </div>
            <div>
              <label class="title">F2 (Optional). Other Role(s)</label>
              <textarea name="F2_other_text" placeholder="If 'Other' selected above, describe it here."></textarea>
            </div>
          </div>
        </div>

        <div class="q">
          <label class="title">F3. Documentation & Evidence Available <span class="req">*</span></label>
          <p class="help">Select all artifacts that exist today.</p>

          <div class="checks cols2">
            <label class="check"><input type="checkbox" name="F3_artifacts" value="Fairness / bias assessment report"><span>Fairness / bias assessment report</span></label>
            <label class="check"><input type="checkbox" name="F3_artifacts" value="Model/system card (fairness section)"><span>Model or system card (fairness section)</span></label>
            <label class="check"><input type="checkbox" name="F3_artifacts" value="Validation findings"><span>Validation findings</span></label>
            <label class="check"><input type="checkbox" name="F3_artifacts" value="Monitoring dashboards/metrics"><span>Monitoring dashboards or metrics</span></label>
            <label class="check"><input type="checkbox" name="F3_artifacts" value="Issue logs / remediation records"><span>Issue logs or remediation records</span></label>
            <label class="check"><input type="checkbox" name="F3_artifacts" value="Regulatory / audit summaries"><span>Regulatory or audit summaries</span></label>
            <label class="check"><input type="checkbox" name="F3_artifacts" value="None"><span>None</span></label>
          </div>

          <label class="title" style="margin-top:10px;">F3 (Optional). Evidence References</label>
          <textarea name="F3_evidence" placeholder="Provide links/IDs to documents in your repository (do not paste sensitive content). One item per line."></textarea>
        </div>
      </div>

      <div class="card">
        <h2 class="section-title">Submission</h2>
        <p class="help">
          Use <b>Save Draft</b> to store progress locally in this browser. <b>Submit</b> runs basic required-field checks and
          exports a JSON copy of your responses (download) to simulate submission.
        </p>
      </div>

      <div class="footerbar">
        <div class="inner">
          <div class="status" id="status">Draft not saved.</div>
          <button type="button" id="clearBtn">Clear</button>
          <button type="button" id="saveBtn">Save Draft</button>
          <button type="submit" class="primary">Submit</button>
        </div>
      </div>
    </form>
  </div>


  <!-- Hidden container used to render a clean PDF snapshot -->
  <div id="pdf-render" aria-hidden="true"></div>



  <!-- PDF export dependencies (client-side) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    const FORM_KEY = "bias_fairness_questionnaire_v1";
    const form = document.getElementById("bf-form");
    const statusEl = document.getElementById("status");

    function nowStamp() {
      const d = new Date();
      return d.toLocaleString();
    }

    function formToJSON(formEl) {
      const data = {};
      const fd = new FormData(formEl);

      // collect multi-value fields (checkbox groups) properly
      for (const [k, v] of fd.entries()) {
        if (data[k] === undefined) data[k] = v;
        else if (Array.isArray(data[k])) data[k].push(v);
        else data[k] = [data[k], v];
      }

      // ensure unchecked checkboxes still appear as empty arrays (for known groups)
      const groups = [
        "A1_objectives","A2_groups","B3_sources","C1_defs","C3_scope",
        "E1_mitigations","F2_roles","F3_artifacts"
      ];
      groups.forEach(g => {
        if (data[g] === undefined) data[g] = [];
        if (!Array.isArray(data[g])) data[g] = [data[g]];
      });

      return data;
    }

    function jsonToForm(formEl, data) {
      // reset first
      formEl.reset();

      // set simple fields
      for (const [k, v] of Object.entries(data || {})) {
        const els = formEl.querySelectorAll(`[name="${CSS.escape(k)}"]`);
        if (!els || els.length === 0) continue;

        // checkbox groups
        if (els[0].type === "checkbox") {
          const values = Array.isArray(v) ? v : [v];
          els.forEach(el => { el.checked = values.includes(el.value); });
          continue;
        }

        // selects/textareas/inputs
        els.forEach(el => { el.value = v; });
      }
    }


    function escapeHTML(s) {
      return String(s ?? "").replace(/[&<>"']/g, (c) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[c]));
    }

    function valueToDisplay(v) {
      if (Array.isArray(v)) return v.length ? v.join(", ") : "";
      return (v ?? "");
    }

    function buildPdfRenderHTML(submission) {
      const { form_id, title, submitted_at, responses } = submission;
      const sections = [
        { key: "A", title: "A. Fairness Objectives, Scope & Stakeholders" },
        { key: "B", title: "B. Data Representativeness & Bias Risk Identification" },
        { key: "C", title: "C. Fairness Definitions & Metrics" },
        { key: "D", title: "D. Testing, Monitoring & Stability" },
        { key: "E", title: "E. Mitigation Controls & Human Oversight" },
        { key: "F", title: "F. Governance, Validation & Accountability" }
      ];

      const keysInSection = (prefix) => Object.keys(responses).filter(k => k.startsWith(prefix));

      let out = "";
      out += `<h1>${escapeHTML(title)}</h1>`;
      out += `<div class="meta"><b>Form ID:</b> ${escapeHTML(form_id)} &nbsp; | &nbsp; <b>Submitted:</b> ${escapeHTML(new Date(submitted_at).toLocaleString())}</div>`;

      sections.forEach(sec => {
        const ks = keysInSection(sec.key);
        if (!ks.length) return;
        out += `<h2>${escapeHTML(sec.title)}</h2>`;
        ks.sort().forEach(k => {
          const v = valueToDisplay(responses[k]);
          // Don't print empty optional fields
          if (String(v).trim() === "") return;
          out += `<div class="item"><div class="k">${escapeHTML(k)}</div><div class="v">${escapeHTML(v)}</div></div>`;
        });
      });

      out += `<div class="meta" style="margin-top:14px;">Generated by Bias &amp; Fairness Questionnaire (static client-side export).</div>`;
      return out;
    }

    async function exportPDF(submission) {
      const target = document.getElementById("pdf-render");
      target.innerHTML = buildPdfRenderHTML(submission);

      // Render to canvas
      const canvas = await html2canvas(target, { scale: 2, useCORS: true, backgroundColor: "#ffffff" });
      const imgData = canvas.toDataURL("image/png");

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: "p", unit: "pt", format: "a4" });

      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      // Calculate image dimensions to fit width
      const imgWidth = pageWidth;
      const imgHeight = (canvas.height * imgWidth) / canvas.width;

      let y = 0;
      let remaining = imgHeight;

      // Add first page
      pdf.addImage(imgData, "PNG", 0, y, imgWidth, imgHeight);

      // If content exceeds page height, add more pages by shifting image upward
      while (remaining > pageHeight) {
        remaining -= pageHeight;
        pdf.addPage();
        pdf.addImage(imgData, "PNG", 0, -(imgHeight - remaining), imgWidth, imgHeight);
      }

      const stamp = new Date(submission.submitted_at).toISOString().slice(0,10);
      pdf.save(`bias_fairness_questionnaire_submission_${stamp}.pdf`);
    }


    function saveDraft() {
      const payload = {
        saved_at: new Date().toISOString(),
        data: formToJSON(form)
      };
      localStorage.setItem(FORM_KEY, JSON.stringify(payload));
      statusEl.textContent = "Draft saved: " + nowStamp();
    }

    function loadDraft() {
      const raw = localStorage.getItem(FORM_KEY);
      if (!raw) return;
      try {
        const payload = JSON.parse(raw);
        jsonToForm(form, payload.data);
        statusEl.textContent = "Draft loaded (saved: " + new Date(payload.saved_at).toLocaleString() + ")";
      } catch (e) {
        console.warn("Failed to load draft:", e);
      }
    }

    function clearDraftAndForm() {
      if (!confirm("Clear all responses and remove saved draft?")) return;
      localStorage.removeItem(FORM_KEY);
      form.reset();
      statusEl.textContent = "Draft cleared.";
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    document.getElementById("saveBtn").addEventListener("click", saveDraft);
    document.getElementById("clearBtn").addEventListener("click", clearDraftAndForm);

    form.addEventListener("submit", async (e) => {
      e.preventDefault();


      statusEl.textContent = "Exporting… generating JSON + PDF.";

      // Basic required validation (browser will catch most, but we’ll show a friendly message too)
      if (!form.checkValidity()) {
        // Let browser render built-in messages by briefly trying to submit
        statusEl.textContent = "Please complete all required fields (*) before submitting.";
        const firstInvalid = form.querySelector(":invalid");
        if (firstInvalid) firstInvalid.scrollIntoView({ behavior: "smooth", block: "center" });
        firstInvalid?.focus?.();
        return;
      }

      const data = formToJSON(form);
      const submission = {
        form_id: "bias_fairness_questionnaire_v1",
        title: "Bias & Fairness Questionnaire",
        submitted_at: new Date().toISOString(),
        responses: data
      };

      // Export #1: JSON download
      const blob = new Blob([JSON.stringify(submission, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "bias_fairness_questionnaire_submission.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      // Export #2: PDF download (snapshot of a clean summary)
      // Note: PDF generation is client-side and may take a few seconds for very long responses.
      await exportPDF(submission);

      statusEl.textContent = "Submitted: " + nowStamp() + " (JSON + PDF exported)";
      // optionally save after submit
      localStorage.setItem(FORM_KEY, JSON.stringify({ saved_at: new Date().toISOString(), data }));
    });

    // Auto-save on change (lightweight)
    let autosaveTimer = null;
    form.addEventListener("input", () => {
      clearTimeout(autosaveTimer);
      autosaveTimer = setTimeout(() => {
        localStorage.setItem(FORM_KEY, JSON.stringify({
          saved_at: new Date().toISOString(),
          data: formToJSON(form)
        }));
        statusEl.textContent = "Auto-saved: " + nowStamp();
      }, 650);
    });

    loadDraft();
  </script>
</body>
</html>
